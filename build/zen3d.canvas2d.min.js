!function(){var t={CONSTANT:function(){var t,e,i,r,s=this._renderViewport,n=s.x,h=s.y,o=s.z,a=s.w,c=this._scaleFactor;t=n,e=h,i=o,r=a,this._resolutionSize.set(i*c,r*c),this.viewport.set(t,e,i,r)},SHRINK:function(){var t,e,i,r,s=this._renderViewport,n=s.x,h=s.y,o=s.z,a=s.w,c=this._resolutionSize,d=(o-n)/(a-h),l=c.x/c.y;l>d?(i=o,r=Math.floor(i/l)):(r=a,i=Math.floor(r*l)),t=Math.floor((o-i)/2)+n,e=Math.floor((a-r)/2)+h,this.viewport.set(t,e,i,r)},EXPAND:function(){var t,e,i,r,s=this._renderViewport,n=s.x,h=s.y,o=s.z,a=s.w,c=this._resolutionSize,d=(o-n)/(a-h),l=c.x/c.y;l>d?(r=a,i=Math.floor(r*l)):(i=o,r=Math.floor(i/l)),t=Math.floor((o-i)/2)+n,e=Math.floor((a-r)/2)+h,this.viewport.set(t,e,i,r)}},e=function(i,r,s,n){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CANVAS2D,this.layer=zen3d.RENDER_LAYER.CANVAS2D,this.frustumCulled=!1,this.geometry=new zen3d.Geometry,this.buffer=new zen3d.InterleavedBuffer(new Float32Array,5),this.buffer.dynamic=!0,this.geometry.addAttribute("a_Position",new zen3d.InterleavedBufferAttribute(this.buffer,3,0)),this.geometry.addAttribute("a_Uv",new zen3d.InterleavedBufferAttribute(this.buffer,2,3)),this.geometry.setIndex([]),this.geometry.usageType=zen3d.WEBGL_BUFFER_USAGE.DYNAMIC_DRAW,this.material=new zen3d.Canvas2DMaterial,this.sprites=[],this.drawArray=[],this._isScreenCanvas=void 0===s||s;var i=void 0!==i?i:640,r=void 0!==r?r:800;this._size=new zen3d.Vector2(i,r),this._resolutionSize=new zen3d.Vector2(i,r),this._screenMatchMode=n||t.CONSTANT,this._renderViewport=new zen3d.Vector4(0,0,i,r),this._scaleFactor=1,this.viewport=new zen3d.Vector4,this.orthoCamera=new zen3d.Camera,this.orthoCamera.setOrtho(-i/2,i/2,-r/2,r/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix)};zen3d.inherit(e,zen3d.Object3D),Object.defineProperties(e.prototype,{isScreenCanvas:{get:function(){return this._isScreenCanvas},set:function(t){this._isScreenCanvas=t}}}),e.prototype.setSize=function(t,e){this._isScreenCanvas?(this._resolutionSize.set(t,e),this._screenMatchMode.call(this),this._updateCamera()):this._size.set(t,e)},e.prototype.setRenderViewport=function(t,e,i,r){this._renderViewport.x===t&&this._renderViewport.y===e&&this._renderViewport.z===i&&this._renderViewport.w===r||(this._renderViewport.set(t,e,i,r),this._screenMatchMode.call(this),this._updateCamera())},e.prototype.setScaleFactor=function(t){this._scaleFactor!==t&&(this._scaleFactor=t,this._screenMatchMode.call(this),this._updateCamera())},e.prototype.setScreenMatchMode=function(t){this._screenMatchMode!==t&&(this._screenMatchMode=t,this._screenMatchMode.call(this),this._updateCamera())},e.prototype._updateCamera=function(){this._isScreenCanvas&&(this.orthoCamera.setOrtho(-this._resolutionSize.x/2,this._resolutionSize.x/2,-this._resolutionSize.y/2,this._resolutionSize.y/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix))},e.prototype.add=function(t){this.children.push(t)},e.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)};var i=[],r=[];e.prototype.updateSprites=function(){for(var t=0,e=0,s=this.sprites,n=this._isScreenCanvas?this._resolutionSize.x:this._size.x,h=this._isScreenCanvas?this._resolutionSize.y:this._size.y,o=0;o<s.length;o++){var a,c,d=(C=s[o]).width,l=C.height,u=C.worldMatrix.elements,p=u[0],f=u[1],y=u[3],_=u[4],v=u[6]-n/2,w=h/2-u[7]-l;a=0,c=0,i[t++]=p*a+y*c+v,i[t++]=f*a+_*c+w,i[t++]=0,i[t++]=0,i[t++]=1,a=0+d,c=0,i[t++]=p*a+y*c+v,i[t++]=f*a+_*c+w,i[t++]=0,i[t++]=1,i[t++]=1,a=0+d,c=0+l,i[t++]=p*a+y*c+v,i[t++]=f*a+_*c+w,i[t++]=0,i[t++]=1,i[t++]=0,a=0,c=0+l,i[t++]=p*a+y*c+v,i[t++]=f*a+_*c+w,i[t++]=0,i[t++]=0,i[t++]=0;var z=t/5-4;r[e++]=z+0,r[e++]=z+1,r[e++]=z+2,r[e++]=z+2,r[e++]=z+3,r[e++]=z+0}i.length=t,r.length=e;var M=this.geometry;this.buffer.setArray(new Float32Array(i)),M.index.setArray(new Uint16Array(r)),this.buffer.version++,M.index.version++,this.drawArray=[];for(var x,o=0;o<s.length;o++){var C=s[o];x!==C.texture?(this.drawArray.push({texture:C.texture,count:1}),x=C.texture):this.drawArray[this.drawArray.length-1].count++}},e.prototype.updateMatrix=function(){e.superClass.updateMatrix.call(this),this.sprites=[];for(var t=this.children,i=0,r=t.length;i<r;i++)this.cacheSprites(t[i]);for(var s=this.sprites,i=0,r=s.length;i<r;i++)s[i].updateMatrix();this.updateSprites()},e.prototype.cacheSprites=function(t){this.sprites.push(t);for(var e=0,i=t.children.length;e<i;e++)this.cacheSprites(t.children[e])},e.SCREEN_MATCH_MODE=t,zen3d.Canvas2D=e}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CANVAS2D,this.depthWrite=!1};zen3d.inherit(t,zen3d.Material),zen3d.Canvas2DMaterial=t}(),function(){var t=function(){this.width=0,this.height=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.anchorX=0,this.anchorY=0,this.matrix=new zen3d.Matrix3,this.worldMatrix=new zen3d.Matrix3,this.children=new Array,this.parent=null,this.boundingBox=new zen3d.Box2};t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1),t.parent=null},t.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},t.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.anchorX*this.width,this.anchorY*this.height);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,r=0,s=i.length;r<s;r++)i[r].updateMatrix()},t.prototype.computeBoundingBox=function(){this.boundingBox.set(this.x,this.y,this.x+this.width,this.y+this.height)},zen3d.Object2D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.texture=null};zen3d.inherit(t,zen3d.Object2D),zen3d.Sprite2D=t}();