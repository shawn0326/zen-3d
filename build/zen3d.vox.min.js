!function(){function r(r){return String.fromCharCode(255&r)+String.fromCharCode(r>>>8&255)+String.fromCharCode(r>>>16&255)+String.fromCharCode(r>>>24&255)}function a(r){for(;r<0;)r+=4294967296;for(;r>4294967295;)r-=4294967296;return r}function e(r,e,t,o,i){var g,b,c,s,h,f,u,y,l;g=o[0],b=o[1],c=o[2],s=o[3],h=i[0],f=i[1],u=i[2],l=t(e[b],e[c],e[s]),y=(y=a(y=e[g]+l+r[h]+n[u]))<<f|y>>>32-f,y+=e[b],e[g]=a(y)}function t(t){var n,o,i,g,b,s,h,f,u,y,l,v,x;if(i=new Array(1732584193,4023233417,2562383102,271733878),b=t.length,s=63&b,(h=s<56?56-s:120-s)>0)for(t+="Â€",y=0;y<h-1;y++)t+="\0";for(t+=r(8*b),t+=r(0),b+=h+8,n=new Array(0,1,2,3),o=new Array(16),g=new Array(4),v=0;v<b;v+=64){for(y=0,l=v;y<16;y++,l+=4)o[y]=t.charCodeAt(l)|t.charCodeAt(l+1)<<8|t.charCodeAt(l+2)<<16|t.charCodeAt(l+3)<<24;for(y=0;y<4;y++)g[y]=i[y];for(y=0;y<4;y++)for(f=c[y][0],u=c[y][1],l=0;l<16;l++)e(o,g,f,n,u[l]),x=n[0],n[0]=n[3],n[3]=n[2],n[2]=n[1],n[1]=x;for(y=0;y<4;y++)i[y]+=g[y],i[y]=a(i[y])}return r(i[0])+r(i[1])+r(i[2])+r(i[3])}var n=new Array(0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745),o=new Array(new Array(0,7,1),new Array(1,12,2),new Array(2,17,3),new Array(3,22,4),new Array(4,7,5),new Array(5,12,6),new Array(6,17,7),new Array(7,22,8),new Array(8,7,9),new Array(9,12,10),new Array(10,17,11),new Array(11,22,12),new Array(12,7,13),new Array(13,12,14),new Array(14,17,15),new Array(15,22,16)),i=new Array(new Array(1,5,17),new Array(6,9,18),new Array(11,14,19),new Array(0,20,20),new Array(5,5,21),new Array(10,9,22),new Array(15,14,23),new Array(4,20,24),new Array(9,5,25),new Array(14,9,26),new Array(3,14,27),new Array(8,20,28),new Array(13,5,29),new Array(2,9,30),new Array(7,14,31),new Array(12,20,32)),g=new Array(new Array(5,4,33),new Array(8,11,34),new Array(11,16,35),new Array(14,23,36),new Array(1,4,37),new Array(4,11,38),new Array(7,16,39),new Array(10,23,40),new Array(13,4,41),new Array(0,11,42),new Array(3,16,43),new Array(6,23,44),new Array(9,4,45),new Array(12,11,46),new Array(15,16,47),new Array(2,23,48)),b=new Array(new Array(0,6,49),new Array(7,10,50),new Array(14,15,51),new Array(5,21,52),new Array(12,6,53),new Array(3,10,54),new Array(10,15,55),new Array(1,21,56),new Array(8,6,57),new Array(15,10,58),new Array(6,15,59),new Array(13,21,60),new Array(4,6,61),new Array(11,10,62),new Array(2,15,63),new Array(9,21,64)),c=new Array(new Array(function(r,a,e){return r&a|~r&e},o),new Array(function(r,a,e){return r&e|a&~e},i),new Array(function(r,a,e){return r^a^e},g),new Array(function(r,a,e){return a^(r|~e)},b));zen3d.md5=function(r){var a,e,n,o;for(o=t(r),e="",a=0;a<16;a++)n=o.charCodeAt(a),e+="0123456789abcdef".charAt(n>>4&15),e+="0123456789abcdef".charAt(15&n);return e}}(),zen3d.VOXData=function(){this.size=null,this.voxels=[],this.palette=[],this.anim=[{size:null,voxels:[]}]},function(){var r=[{r:255,g:255,b:255,a:255},{r:255,g:255,b:255,a:255},{r:255,g:255,b:204,a:255},{r:255,g:255,b:153,a:255},{r:255,g:255,b:102,a:255},{r:255,g:255,b:51,a:255},{r:255,g:255,b:0,a:255},{r:255,g:204,b:255,a:255},{r:255,g:204,b:204,a:255},{r:255,g:204,b:153,a:255},{r:255,g:204,b:102,a:255},{r:255,g:204,b:51,a:255},{r:255,g:204,b:0,a:255},{r:255,g:153,b:255,a:255},{r:255,g:153,b:204,a:255},{r:255,g:153,b:153,a:255},{r:255,g:153,b:102,a:255},{r:255,g:153,b:51,a:255},{r:255,g:153,b:0,a:255},{r:255,g:102,b:255,a:255},{r:255,g:102,b:204,a:255},{r:255,g:102,b:153,a:255},{r:255,g:102,b:102,a:255},{r:255,g:102,b:51,a:255},{r:255,g:102,b:0,a:255},{r:255,g:51,b:255,a:255},{r:255,g:51,b:204,a:255},{r:255,g:51,b:153,a:255},{r:255,g:51,b:102,a:255},{r:255,g:51,b:51,a:255},{r:255,g:51,b:0,a:255},{r:255,g:0,b:255,a:255},{r:255,g:0,b:204,a:255},{r:255,g:0,b:153,a:255},{r:255,g:0,b:102,a:255},{r:255,g:0,b:51,a:255},{r:255,g:0,b:0,a:255},{r:204,g:255,b:255,a:255},{r:204,g:255,b:204,a:255},{r:204,g:255,b:153,a:255},{r:204,g:255,b:102,a:255},{r:204,g:255,b:51,a:255},{r:204,g:255,b:0,a:255},{r:204,g:204,b:255,a:255},{r:204,g:204,b:204,a:255},{r:204,g:204,b:153,a:255},{r:204,g:204,b:102,a:255},{r:204,g:204,b:51,a:255},{r:204,g:204,b:0,a:255},{r:204,g:153,b:255,a:255},{r:204,g:153,b:204,a:255},{r:204,g:153,b:153,a:255},{r:204,g:153,b:102,a:255},{r:204,g:153,b:51,a:255},{r:204,g:153,b:0,a:255},{r:204,g:102,b:255,a:255},{r:204,g:102,b:204,a:255},{r:204,g:102,b:153,a:255},{r:204,g:102,b:102,a:255},{r:204,g:102,b:51,a:255},{r:204,g:102,b:0,a:255},{r:204,g:51,b:255,a:255},{r:204,g:51,b:204,a:255},{r:204,g:51,b:153,a:255},{r:204,g:51,b:102,a:255},{r:204,g:51,b:51,a:255},{r:204,g:51,b:0,a:255},{r:204,g:0,b:255,a:255},{r:204,g:0,b:204,a:255},{r:204,g:0,b:153,a:255},{r:204,g:0,b:102,a:255},{r:204,g:0,b:51,a:255},{r:204,g:0,b:0,a:255},{r:153,g:255,b:255,a:255},{r:153,g:255,b:204,a:255},{r:153,g:255,b:153,a:255},{r:153,g:255,b:102,a:255},{r:153,g:255,b:51,a:255},{r:153,g:255,b:0,a:255},{r:153,g:204,b:255,a:255},{r:153,g:204,b:204,a:255},{r:153,g:204,b:153,a:255},{r:153,g:204,b:102,a:255},{r:153,g:204,b:51,a:255},{r:153,g:204,b:0,a:255},{r:153,g:153,b:255,a:255},{r:153,g:153,b:204,a:255},{r:153,g:153,b:153,a:255},{r:153,g:153,b:102,a:255},{r:153,g:153,b:51,a:255},{r:153,g:153,b:0,a:255},{r:153,g:102,b:255,a:255},{r:153,g:102,b:204,a:255},{r:153,g:102,b:153,a:255},{r:153,g:102,b:102,a:255},{r:153,g:102,b:51,a:255},{r:153,g:102,b:0,a:255},{r:153,g:51,b:255,a:255},{r:153,g:51,b:204,a:255},{r:153,g:51,b:153,a:255},{r:153,g:51,b:102,a:255},{r:153,g:51,b:51,a:255},{r:153,g:51,b:0,a:255},{r:153,g:0,b:255,a:255},{r:153,g:0,b:204,a:255},{r:153,g:0,b:153,a:255},{r:153,g:0,b:102,a:255},{r:153,g:0,b:51,a:255},{r:153,g:0,b:0,a:255},{r:102,g:255,b:255,a:255},{r:102,g:255,b:204,a:255},{r:102,g:255,b:153,a:255},{r:102,g:255,b:102,a:255},{r:102,g:255,b:51,a:255},{r:102,g:255,b:0,a:255},{r:102,g:204,b:255,a:255},{r:102,g:204,b:204,a:255},{r:102,g:204,b:153,a:255},{r:102,g:204,b:102,a:255},{r:102,g:204,b:51,a:255},{r:102,g:204,b:0,a:255},{r:102,g:153,b:255,a:255},{r:102,g:153,b:204,a:255},{r:102,g:153,b:153,a:255},{r:102,g:153,b:102,a:255},{r:102,g:153,b:51,a:255},{r:102,g:153,b:0,a:255},{r:102,g:102,b:255,a:255},{r:102,g:102,b:204,a:255},{r:102,g:102,b:153,a:255},{r:102,g:102,b:102,a:255},{r:102,g:102,b:51,a:255},{r:102,g:102,b:0,a:255},{r:102,g:51,b:255,a:255},{r:102,g:51,b:204,a:255},{r:102,g:51,b:153,a:255},{r:102,g:51,b:102,a:255},{r:102,g:51,b:51,a:255},{r:102,g:51,b:0,a:255},{r:102,g:0,b:255,a:255},{r:102,g:0,b:204,a:255},{r:102,g:0,b:153,a:255},{r:102,g:0,b:102,a:255},{r:102,g:0,b:51,a:255},{r:102,g:0,b:0,a:255},{r:51,g:255,b:255,a:255},{r:51,g:255,b:204,a:255},{r:51,g:255,b:153,a:255},{r:51,g:255,b:102,a:255},{r:51,g:255,b:51,a:255},{r:51,g:255,b:0,a:255},{r:51,g:204,b:255,a:255},{r:51,g:204,b:204,a:255},{r:51,g:204,b:153,a:255},{r:51,g:204,b:102,a:255},{r:51,g:204,b:51,a:255},{r:51,g:204,b:0,a:255},{r:51,g:153,b:255,a:255},{r:51,g:153,b:204,a:255},{r:51,g:153,b:153,a:255},{r:51,g:153,b:102,a:255},{r:51,g:153,b:51,a:255},{r:51,g:153,b:0,a:255},{r:51,g:102,b:255,a:255},{r:51,g:102,b:204,a:255},{r:51,g:102,b:153,a:255},{r:51,g:102,b:102,a:255},{r:51,g:102,b:51,a:255},{r:51,g:102,b:0,a:255},{r:51,g:51,b:255,a:255},{r:51,g:51,b:204,a:255},{r:51,g:51,b:153,a:255},{r:51,g:51,b:102,a:255},{r:51,g:51,b:51,a:255},{r:51,g:51,b:0,a:255},{r:51,g:0,b:255,a:255},{r:51,g:0,b:204,a:255},{r:51,g:0,b:153,a:255},{r:51,g:0,b:102,a:255},{r:51,g:0,b:51,a:255},{r:51,g:0,b:0,a:255},{r:0,g:255,b:255,a:255},{r:0,g:255,b:204,a:255},{r:0,g:255,b:153,a:255},{r:0,g:255,b:102,a:255},{r:0,g:255,b:51,a:255},{r:0,g:255,b:0,a:255},{r:0,g:204,b:255,a:255},{r:0,g:204,b:204,a:255},{r:0,g:204,b:153,a:255},{r:0,g:204,b:102,a:255},{r:0,g:204,b:51,a:255},{r:0,g:204,b:0,a:255},{r:0,g:153,b:255,a:255},{r:0,g:153,b:204,a:255},{r:0,g:153,b:153,a:255},{r:0,g:153,b:102,a:255},{r:0,g:153,b:51,a:255},{r:0,g:153,b:0,a:255},{r:0,g:102,b:255,a:255},{r:0,g:102,b:204,a:255},{r:0,g:102,b:153,a:255},{r:0,g:102,b:102,a:255},{r:0,g:102,b:51,a:255},{r:0,g:102,b:0,a:255},{r:0,g:51,b:255,a:255},{r:0,g:51,b:204,a:255},{r:0,g:51,b:153,a:255},{r:0,g:51,b:102,a:255},{r:0,g:51,b:51,a:255},{r:0,g:51,b:0,a:255},{r:0,g:0,b:255,a:255},{r:0,g:0,b:204,a:255},{r:0,g:0,b:153,a:255},{r:0,g:0,b:102,a:255},{r:0,g:0,b:51,a:255},{r:238,g:0,b:0,a:255},{r:221,g:0,b:0,a:255},{r:187,g:0,b:0,a:255},{r:170,g:0,b:0,a:255},{r:136,g:0,b:0,a:255},{r:119,g:0,b:0,a:255},{r:85,g:0,b:0,a:255},{r:68,g:0,b:0,a:255},{r:34,g:0,b:0,a:255},{r:17,g:0,b:0,a:255},{r:0,g:238,b:0,a:255},{r:0,g:221,b:0,a:255},{r:0,g:187,b:0,a:255},{r:0,g:170,b:0,a:255},{r:0,g:136,b:0,a:255},{r:0,g:119,b:0,a:255},{r:0,g:85,b:0,a:255},{r:0,g:68,b:0,a:255},{r:0,g:34,b:0,a:255},{r:0,g:17,b:0,a:255},{r:0,g:0,b:238,a:255},{r:0,g:0,b:221,a:255},{r:0,g:0,b:187,a:255},{r:0,g:0,b:170,a:255},{r:0,g:0,b:136,a:255},{r:0,g:0,b:119,a:255},{r:0,g:0,b:85,a:255},{r:0,g:0,b:68,a:255},{r:0,g:0,b:34,a:255},{r:0,g:0,b:17,a:255},{r:238,g:238,b:238,a:255},{r:221,g:221,b:221,a:255},{r:187,g:187,b:187,a:255},{r:170,g:170,b:170,a:255},{r:136,g:136,b:136,a:255},{r:119,g:119,b:119,a:255},{r:85,g:85,b:85,a:255},{r:68,g:68,b:68,a:255},{r:34,g:34,b:34,a:255},{r:17,g:17,b:17,a:255}];zen3d.VOXDefaultPalette=r}(),function(){var r=function(r,a,e,t,n,o){this.a=r,this.b=a,this.c=e,this.normal=t||new zen3d.Vector3,this.color=n||new zen3d.Color3,this.materialIndex=void 0!==o?o:0};r.prototype.copy=function(r){return this.a=r.a,this.b=r.b,this.c=r.c,this.normal.copy(r.normal),this.color.copy(r.color),this.materialIndex=r.materialIndex,this},r.prototype.clone=function(){return(new r).copy(this)},zen3d.VOXFace3=r}(),function(){var r=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]};r.prototype.computeFaceNormals=function(){for(var r=new zen3d.Vector3,a=new zen3d.Vector3,e=0,t=this.faces.length;e<t;e++){var n=this.faces[e],o=this.vertices[n.a],i=this.vertices[n.b],g=this.vertices[n.c];r.subVectors(g,i),a.subVectors(o,i),r.cross(a),r.normalize(),n.normal.copy(r)}},r.prototype.merge=function(r,a,e){var t,n=this.vertices.length,o=this.vertices,i=r.vertices,g=this.faces,b=r.faces,c=this.faceVertexUvs[0],s=r.faceVertexUvs[0];void 0===e&&(e=0),void 0!==a&&(t=(new zen3d.Matrix3).setFromMatrix4(a).inverse().transpose());for(var h=0,f=i.length;h<f;h++){var u=i[h].clone();void 0!==a&&u.applyMatrix4(a),o.push(u)}for(h=0,f=b.length;h<f;h++){var y,l=b[h];(y=new zen3d.VOXFace3(l.a+n,l.b+n,l.c+n)).normal.copy(l.normal),void 0!==t&&y.normal.applyMatrix3(t).normalize(),y.color.copy(l.color),y.materialIndex=l.materialIndex+e,g.push(y)}for(h=0,f=s.length;h<f;h++){var v=s[h],x=[];if(void 0!==v){for(var w=0,A=v.length;w<A;w++)x.push(v[w].clone());c.push(x)}}},r.prototype.mergeVertices=function(){var r,a,e,t,n,o,i,g,b={},c=[],s=[],h=Math.pow(10,4);for(e=0,t=this.vertices.length;e<t;e++)r=this.vertices[e],void 0===b[a=Math.round(r.x*h)+"_"+Math.round(r.y*h)+"_"+Math.round(r.z*h)]?(b[a]=e,c.push(this.vertices[e]),s[e]=c.length-1):s[e]=s[b[a]];var f=[];for(e=0,t=this.faces.length;e<t;e++){(n=this.faces[e]).a=s[n.a],n.b=s[n.b],n.c=s[n.c],o=[n.a,n.b,n.c];for(var u=0;u<3;u++)if(o[u]===o[(u+1)%3]){f.push(e);break}}for(e=f.length-1;e>=0;e--){var y=f[e];for(this.faces.splice(y,1),i=0,g=this.faceVertexUvs.length;i<g;i++)this.faceVertexUvs[i].splice(y,1)}var l=this.vertices.length-c.length;return this.vertices=c,l},r.prototype.createGeometry=function(){var r=new zen3d.Geometry;r.vertexFormat={a_Position:{size:3,normalized:!1,stride:12,offset:0},a_Normal:{size:3,normalized:!1,stride:12,offset:3},a_Color:{size:4,normalized:!1,stride:12,offset:6},a_Uv:{size:2,normalized:!1,stride:12,offset:10}},r.vertexSize=12;for(var a=this.faces,e=this.vertices,t=this.faceVertexUvs,n=t[0]&&t[0].length>0,o=(t[1]&&t[1].length,0);o<a.length;o++){var i,g,b,c,s=a[o];i=[e[s.a],e[s.b],e[s.c]];var h=s.normal;g=[h,h,h];var f=s.color;if(b=[f,f,f],!0===n){var u=t[0][o];void 0!==u?c=[u[0],u[1],u[2]]:(console.warn("createGeometry(): Undefined vertexUv ",o),c=[new Vector2,new Vector2,new Vector2])}!function(a,e,t,n){for(var o=0;o<3;o++)r.verticesArray.push(a[o].x,a[o].y,a[o].z),r.verticesArray.push(e[o].x,e[o].y,e[o].z),r.verticesArray.push(t[o].r,t[o].g,t[o].b,1),n?r.verticesArray.push(n[o].x,n[o].y):r.verticesArray.push(0,0)}(i,g,b,c)}return r},zen3d.VOXGeometry=r}(),function(){var r=function(){};r.prototype.load=function(r,a,e,t){(new zen3d.FileLoader).setResponseType("arraybuffer").load(r,function(r){var e=this.parse(new Uint8Array(r));a(e)}.bind(this),e,t)},r.prototype.parse=function(r){var t=new a(r);try{return e(t),t.data.size=t.data.anim[0].size,t.data.voxels=t.data.anim[0].voxels,0===t.data.palette.length?t.data.palette=zen3d.VOXDefaultPalette:(t.data.palette.unshift(t.data.palette[0]),t.data.palette.pop()),t.data}catch(r){console.error(r)}},zen3d.VOXLoader=r;var a=function(r){this.uint8Array=r,this.cursor=0,this.data=new zen3d.VOXData,this._currentChunkId=null,this._currentChunkSize=0};a.prototype.next=function(){if(this.uint8Array.byteLength<=this.cursor)throw new Error("uint8Array index out of bounds: "+this.uint8Array.byteLength);return this.uint8Array[this.cursor++]},a.prototype.hasNext=function(){return this.cursor<this.uint8Array.byteLength};var e=function(r){t(r),n(r),o(r)},t=function(r){for(var a="",e=0;e<4;e++)a+=String.fromCharCode(r.next());if("VOX "!==a)throw new Error("invalid magic number '"+a+"'")},n=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);console.info(".vox format version "+a)},o=function(r){if(!r.hasNext())return!1;for(i(r),g(r),b(r),c(r);o(r););return r.hasNext()},i=function(r){for(var a="",e=0;e<4;e++)a+=String.fromCharCode(r.next());r._currentChunkId=a,r._currentChunkSize=0},g=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);r._currentChunkSize=a},b=function(r){for(var a=0;a<4;a++)r.next()*Math.pow(256,a)},c=function(r){switch(r._currentChunkId){case"PACK":s(r);break;case"SIZE":h(r);break;case"XYZI":f(r);break;case"RGBA":u(r);break;case"MATT":y(r)}},s=function(r){for(var a=0;a<4;a++)r.next()*Math.pow(256,a)},h=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);for(var t=0,e=0;e<4;e++)t+=r.next()*Math.pow(256,e);for(var n=0,e=0;e<4;e++)n+=r.next()*Math.pow(256,e);var o=r.data.anim[r.data.anim.length-1];o.size&&(o={size:null,voxels:[]},r.data.anim.push(o)),o.size={x:a,y:t,z:n}},f=function(r){for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);var t=r.data.anim[r.data.anim.length-1];t.voxels.length&&(t={size:null,voxels:[]},r.data.anim.push(t));for(e=0;e<a;e++)t.voxels.push({x:r.next(),y:r.next(),z:r.next(),colorIndex:r.next()})},u=function(r){for(var a=0;a<256;a++){var e={r:r.next(),g:r.next(),b:r.next(),a:r.next()};r.data.palette.push(e)}},y=function(r){for(e=0;e<4;e++)r.next()*Math.pow(256,e);for(e=0;e<4;e++)r.next()*Math.pow(256,e);for(e=0;e<4;e++)r.next()*Math.pow(256,e);for(var a=0,e=0;e<4;e++)a+=r.next()*Math.pow(256,e);var t=!!(2&a),n=!!(4&a),o=!!(8&a),i=!!(16&a),g=!!(32&a),b=!!(64&a),c=0;!!(1&a)&&(c+=1),t&&(c+=1),n&&(c+=1),o&&(c+=1),i&&(c+=1),g&&(c+=1),b&&(c+=1);for(var s=[],h=0;h<c;h++){s[h]=0;for(e=0;e<4;e++)s[h]+=r.next()*Math.pow(256,e)}}}(),function(){var r=function(a,e){r.textureFactory||(r.textureFactory=new zen3d.VOXTextureFactory),e=e||{},this.voxelData=a,this.voxelSize=e.voxelSize||r.DEFAULT_PARAM.voxelSize,this.vertexColor=void 0===e.vertexColor?r.DEFAULT_PARAM.vertexColor:e.vertexColor,this.optimizeFaces=void 0===e.optimizeFaces?r.DEFAULT_PARAM.optimizeFaces:e.optimizeFaces,this.originToBottom=void 0===e.originToBottom?r.DEFAULT_PARAM.originToBottom:e.originToBottom,this.geometry=null,this.material=null,this._build()};r.prototype._build=function(){this.geometry=new zen3d.Geometry,this.material=new zen3d.PhongMaterial;var a=new zen3d.VOXGeometry;this.hashTable=o(this.voxelData.voxels);var e=-.5*(this.voxelData.size.x-1),t=-.5*(this.voxelData.size.y-1),n=this.originToBottom?0:-.5*(this.voxelData.size.z-1),i=new zen3d.Matrix4;this.voxelData.voxels.forEach(function(r){var o=this._createVoxGeometry(r);o&&(i.makeTranslation((r.x+e)*this.voxelSize,(r.z+n)*this.voxelSize,-(r.y+t)*this.voxelSize),a.merge(o,i))}.bind(this)),this.optimizeFaces&&a.mergeVertices(),a.computeFaceNormals(),this.geometry=a.createGeometry(),this.vertexColor?this.material.vertexColors=!0:this.material.diffuseMap=r.textureFactory.getTexture(this.voxelData)},r.prototype._createVoxGeometry=function(r){var n=[];if(this.optimizeFaces&&a.forEach(function(a){this.hashTable.has(r.x+a.x,r.y+a.y,r.z+a.z)&&n.push(a.ignoreFace)}.bind(this)),6===n.length)return null;var o=e.map(function(r){return new zen3d.Vector3(r.x*this.voxelSize*.5,r.y*this.voxelSize*.5,r.z*this.voxelSize*.5)}.bind(this)),i=t.map(function(r){return{faceA:new zen3d.VOXFace3(r.faceA.a,r.faceA.b,r.faceA.c),faceB:new zen3d.VOXFace3(r.faceB.a,r.faceB.b,r.faceB.c)}});if(this.vertexColor)var g=this.voxelData.palette[r.colorIndex],b=new zen3d.Color3(g.r/255,g.g/255,g.b/255);var c=new zen3d.VOXGeometry;c.faceVertexUvs[0]=[],i.forEach(function(a,e){if(!(n.indexOf(e)>=0)){if(this.vertexColor)a.faceA.color=b,a.faceB.color=b;else{var t=new zen3d.Vector2((r.colorIndex+.5)/256,.5);c.faceVertexUvs[0].push([t,t,t],[t,t,t])}c.faces.push(a.faceA,a.faceB)}}.bind(this));var s={};c.faces.forEach(function(r){s[r.a]=!0,s[r.b]=!0,s[r.c]=!0});var h=function(r){c.faces.forEach(function(a){a.a>r&&(a.a-=1),a.b>r&&(a.b-=1),a.c>r&&(a.c-=1)})},f=0;return o.forEach(function(r,a){s[a]?c.vertices.push(r):(h(a-f),f+=1)}),c},r.prototype.getTexture=function(){return r.textureFactory.getTexture(this.voxelData)},r.prototype.createMesh=function(){return new zen3d.Mesh(this.geometry,this.material)},r.prototype.isOuterVoxel=function(r){return a.filter(function(a){return this.hashTable.has(r.x+a.x,r.y+a.y,r.z+a.z)}.bind(this)).length<6},r.DEFAULT_PARAM={voxelSize:1,vertexColor:!1,optimizeFaces:!0,originToBottom:!0},r.textureFactory=void 0,zen3d.VOXMeshBuilder=r;var a=[{x:-1,y:0,z:0,ignoreFace:0},{x:1,y:0,z:0,ignoreFace:1},{x:0,y:-1,z:0,ignoreFace:5},{x:0,y:1,z:0,ignoreFace:4},{x:0,y:0,z:-1,ignoreFace:2},{x:0,y:0,z:1,ignoreFace:3}],e=[{x:-1,y:1,z:-1},{x:1,y:1,z:-1},{x:-1,y:1,z:1},{x:1,y:1,z:1},{x:-1,y:-1,z:-1},{x:1,y:-1,z:-1},{x:-1,y:-1,z:1},{x:1,y:-1,z:1}],t=[{faceA:{a:6,b:2,c:0},faceB:{a:6,b:0,c:4}},{faceA:{a:5,b:1,c:3},faceB:{a:5,b:3,c:7}},{faceA:{a:5,b:7,c:6},faceB:{a:5,b:6,c:4}},{faceA:{a:2,b:3,c:1},faceB:{a:2,b:1,c:0}},{faceA:{a:4,b:0,c:1},faceB:{a:4,b:1,c:5}},{faceA:{a:7,b:3,c:2},faceB:{a:7,b:2,c:6}}],n=function(r,a,e){return"x"+r+"y"+a+"z"+e},o=function(r){var a={};return r.forEach(function(r){a[n(r.x,r.y,r.z)]=!0}),a.has=function(r,a,e){return n(r,a,e)in this},a}}(),function(){var r=function(){};r.prototype.createCanvas=function(r){var a=document.createElement("canvas");a.width=256,a.height=1;for(var e=a.getContext("2d"),t=0,n=r.palette.length;t<n;t++){var o=r.palette[t];e.fillStyle="rgb("+o.r+","+o.g+","+o.b+")",e.fillRect(1*t,0,1,1)}return a},r.prototype.getTexture=function(r){var t=r.palette,n=e(t);if(n in a)return a[n];var o=this.createCanvas(r),i=new zen3d.Texture2D;return i.image=o,i.version++,a[n]=i,i},zen3d.VOXTextureFactory=r;var a={},e=function(r){for(var a="",e=0;e<256;e++){var n=r[e];a+=t(n.r),a+=t(n.g),a+=t(n.b),a+=t(n.a)}return zen3d.md5(a)},t=function(r){var a=r.toString(16);return 1===a.length?"0"+a:a}}();